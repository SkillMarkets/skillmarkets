{% extends "base.html" %}
{% block title %}–ß–∞—Ç —Å {{ other.username }} ‚Äî SkillMarkets{% endblock %}
{% block content %}
<div class="card">
    <h2>üí¨ –ß–∞—Ç —Å {{ other.username }}</h2>

    <!-- –°–æ–æ–±—â–µ–Ω–∏—è -->
    <div id="messages-container" style="height: 400px; overflow-y: auto; border: 1px solid #eee; border-radius: 8px; padding: 15px; margin-bottom: 20px; background: #fcfdfe;">
        {% for msg in messages %}
            <div class="message" style="margin-bottom: 12px; {% if msg.sender_id == current_user.id %}text-align:right;{% endif %}">
                <small style="color: #666; display:block;">{{ msg.timestamp.strftime('%H:%M') }}</small>
                <strong style="color: {% if msg.sender_id == current_user.id %}var(--primary){% else %}#495057{% endif %};">
                    {{ msg.sender.username }}:
                </strong>
                {{ msg.content }}
            </div>
        {% else %}
            <em>–ù–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–π. –ù–∞—á–Ω–∏—Ç–µ –ø–µ—Ä–≤—ã–º!</em>
        {% endfor %}
    </div>

    <!-- –§–æ—Ä–º–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ -->
    <form id="chat-form" method="POST" action="{{ url_for('main.send_message', user_id=other.id) }}">
        <textarea name="content" id="message-input" rows="3" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..." style="width:100%; margin-bottom:10px;" required></textarea>
        <button type="submit" class="btn">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
    </form>
</div>

<a href="{{ url_for('main.index') }}" style="display:inline-block; margin-top:15px;">‚Üê –ù–∞–∑–∞–¥ –Ω–∞ –≥–ª–∞–≤–Ω—É—é</a>

<!-- JavaScript –¥–ª—è –∞–≤—Ç–æ—Å–∫—Ä–æ–ª–ª–∞ –∏ –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø–æ Enter -->
<script>
    // –ê–≤—Ç–æ—Å–∫—Ä–æ–ª–ª –∫ –ø–æ—Å–ª–µ–¥–Ω–µ–º—É —Å–æ–æ–±—â–µ–Ω–∏—é
    const messagesContainer = document.getElementById('messages-container');
    messagesContainer.scrollTop = messagesContainer.scrollHeight;

    // –û—Ç–ø—Ä–∞–≤–∫–∞ –ø–æ Enter (–±–µ–∑ Ctrl/Shift)
    document.getElementById('message-input').addEventListener('keydown', function(e) {
        if (e.key === 'Enter' && !e.shiftKey) {
            e.preventDefault();
            document.getElementById('chat-form').submit();
        }
    });
</script>
{% endblock %}