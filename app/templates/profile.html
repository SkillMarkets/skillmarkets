{% extends "base.html" %}
{% block content %}
<div class="card">
    <h2>–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å</h2>
    <p><strong>–ò–º—è:</strong> {{ user.username }}</p>
    <p><strong>Email:</strong> {{ user.email }}</p>
    <p><strong>–†–æ–ª—å:</strong> {% if user.is_tutor %}–†–µ–ø–µ—Ç–∏—Ç–æ—Ä{% else %}–°—Ç—É–¥–µ–Ω—Ç{% endif %}</p>

    {% if user.is_tutor and user.average_rating > 0 %}
        <p><strong>–†–µ–π—Ç–∏–Ω–≥:</strong> ‚≠ê {{ user.average_rating }} ({{ user.reviews_received|length }} –æ—Ç–∑—ã–≤–æ–≤)</p>
    {% endif %}

    {% if user.is_tutor %}
        <a href="{{ url_for('main.new_offer') }}" class="btn" style="margin:15px 0;">‚ûï –î–æ–±–∞–≤–∏—Ç—å —É—Å–ª—É–≥—É</a>
        {% if user.offers %}
            <h3>–í–∞—à–∏ —É—Å–ª—É–≥–∏</h3>
            {% for offer in user.offers %}
            <div style="background:#f8f9fa; padding:12px; border-radius:8px; margin:10px 0;">
                <strong>{{ offer.title }}</strong> ‚Äî ${{ offer.price_per_hour }}/—á–∞—Å<br>
                {{ offer.subject }}
            </div>
            {% endfor %}
        {% endif %}
    {% endif %}

    <h3>–ò—Å—Ç–æ—Ä–∏—è –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π</h3>
    {% set bookings = user.bookings_as_student if not user.is_tutor else user.bookings_as_tutor %}
    {% if bookings %}
        {% for b in bookings %}
        <div style="border-left: 4px solid var(--primary); padding-left: 15px; margin: 15px 0;">
            {% if user.is_tutor %}
                <p><strong>–°—Ç—É–¥–µ–Ω—Ç:</strong> {{ b.student.username }}</p>
            {% else %}
                <p><strong>–†–µ–ø–µ—Ç–∏—Ç–æ—Ä:</strong> {{ b.tutor.username }}</p>
            {% endif %}
            <p><strong>–£—Å–ª—É–≥–∞:</strong> {{ b.offer.title }}</p>
            <p><strong>–í—Ä–µ–º—è:</strong> {{ b.start_time.strftime('%d.%m %H:%M') }} ‚Äî {{ b.end_time.strftime('%H:%M') }}</p>
            <p><strong>–°—Ç–∞—Ç—É—Å:</strong> {{ b.status }}</p>
            
            {% if not user.is_tutor and b.status == 'pending' %}
                <a href="{{ url_for('main.pay_booking', booking_id=b.id) }}" class="btn">üí≥ –û–ø–ª–∞—Ç–∏—Ç—å</a>
            {% elif not user.is_tutor and b.status == 'completed' %}
                {% if not (b.id in [r.booking_id for r in current_user.reviews_given]) %}
                    <a href="{{ url_for('main.leave_review', booking_id=b.id) }}" class="btn btn-outline">‚≠ê –û—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤</a>
                {% endif %}
            {% endif %}
        </div>
        {% endfor %}
    {% else %}
        <p>–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π.</p>
    {% endif %}
</div>
{% endblock %}